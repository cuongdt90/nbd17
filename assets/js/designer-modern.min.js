function checkMobileDevice(){
    var isMobile = false; 
    if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent) 
    || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))) isMobile = true;    
    return isMobile;
};

(function ($) {
    var modern = {
        init: function () {
            this.mainBar();
            this.mainMenu();
            this.clickOutside();
            this.sideBar.init();
            this.toolBar.init();
            this.showPopup();
            this.animateStart();
            this.actionPopupShare();
            this.actionPopupKeyboard();
            this.actionShowPreview();
            this.responsive();
            this.checkDevice();

        },
        checkDevice: function () {
            var uA = navigator.userAgent;
            if(uA.indexOf('Trident') != -1 && uA.indexOf('rv:11') != -1){
                $('body').addClass('ie');
            }
            else if(navigator.userAgent.indexOf("Firefox")!=-1){
                $('body').addClass('firefox');
            }
            else if(navigator.userAgent.indexOf("Opera")!=-1){
                $('body').addClass('Opera');
            }
            else if(navigator.userAgent.indexOf("Chrome") != -1){
                $('body').addClass('chrome');
            }
            else if(navigator.userAgent.indexOf("Safari")!=-1 && navigator.userAgent.indexOf("CriOS") ==-1){
                $('body').addClass('safari');
            }
        },
        clickOutside: function () {
            var $menuItem = $('.nbd-main-menu .menu-item,.nbd-dropdown');
            var $colorPallette = $('.nbd-color-palette');
            var $win = $(document);
            $win.on("click", function(event){
                if ($menuItem.has(event.target).length == 0 && !$menuItem.is(event.target)){
                    $menuItem.removeClass('active');
                }
                if ($colorPallette.has(event.target).length == 0 && !$colorPallette.is(event.target) && !$('.nbd-show-color-palette span').is(event.target)) {
                    $colorPallette.removeClass('show');
                }
            });
        },
        mainMenu: function () {
            var $menuItem = $('.nbd-main-menu .menu-item');
            var $nbdDropdown = $('.nbd-dropdown');
            var $subMenu = $('.nbd-main-menu .menu-item .sub-menu');
            var $nbdSubDropdown = $('.nbd-sub-dropdown');
            var $subMenuItem = $('.nbd-main-menu .menu-item .sub-menu-item');
            var $closeSubMenu = $('.nbd-close-sub-menu');
            var $subMenuHover = $('.nbd-main-menu .sub-menu .hover-menu');
            var clickOutside = false;

            $menuItem.on('click', function (event) {
                var target = $(event.target);
                if ( target.hasClass('sub-menu-item') || target.parents('.sub-menu-item').length 
                        || !( target.hasClass('sub-menu') || target.parents('.sub-menu').length ) ){
                    if ($(this).find('.sub-menu').length) {
                        if (!$(this).hasClass('active')) {
                            $menuItem.removeClass('active');
                            $(this).addClass('active');
                        }else {
                            $(this).removeClass('active');
                        }
                    }
                }
            });
            $nbdDropdown.on('click', function () {
                if ($(this).find('.nbd-sub-dropdown').length) {
                    if (!$(this).hasClass('active')) {
                        $(this).addClass('active');
                    }else {
                        $(this).removeClass('active');
                    }
                }
            });
            $closeSubMenu.on('click', function () {
                $menuItem.removeClass('active');
            });
//            $subMenuItem.on('click', function () {
//                return false;
//            });
//            $subMenu.on('click', function () {
//                return false;
//            });
//            $nbdSubDropdown.on('click', function () {
//                return false;
//            });

            // Hover in submenu
            $subMenuHover.on({
                mouseenter: function () {
                    if (!checkMobileDevice()) {
                        $(this).addClass('show');
                    }
                },
                mouseleave: function () {
                    if (!checkMobileDevice()) {
                        $(this).removeClass('show');
                    }
                },
                click: function () {
                    if ($(this).hasClass('show')) {
                        $(this).removeClass('show');
                    }else {
                        $(this).siblings().removeClass('show');
                        $(this).addClass('show');
                    }
                }
            });
            if (checkMobileDevice()) {
                $subMenuHover.find(' > i').removeClass('rotate-90');
            }
        },
        mainBar: function () {
            var $mainBar = $('.nbd-main-bar');
        },
        sideBar: {
            init: function () {
                this.tab();
                this.tabPhto.init();
                this.tabLayer.init();
                this.tabProductTemplate();
                this.tabSvg();
                this.tabTypography();
                this.tabElement.init();
            },
            tab: function () {
                var $tab = $('.nbd-sidebar .tabs-nav .tab');
                var $tabContent = $('.nbd-sidebar .tabs-content .tab');
                var $tabLayer = $('.nbd-sidebar .tabs-nav .tab.layerTab');
                var responsive = $(window).width();

                if (checkMobileDevice()) {
                    $tabContent.filter('.active').prevAll().addClass('left');
                    $tabContent.filter('.active').nextAll().addClass('right');
                    $tab.filter('.tab-first').removeClass('active');
                    $('.nbd-sidebar .tabs-content').addClass('nbd-hidden');

                }else{
                    $tabContent.filter('.active').prevAll().addClass('before');
                    $tabContent.filter('.active').nextAll().addClass('after');
                }
                $tab.on('click', function () {
                    var i = $(this).index();
                    i = ($tabLayer.length) ? parseInt(i) - 1 : parseInt(i);
                    var nthTab = 'tab-' + i;

                    if ($(this).hasClass('layerTab')) {
                        $('.nbd-sidebar .tabs-content').hide();
                    }else{
                        $('.nbd-sidebar .tabs-content').show();
                        $('.nbd-sidebar .tabs-content').removeClass('nbd-hidden');
                    }

                    if (checkMobileDevice()) {
                        if ($(this).hasClass('layerTab')) {
                            $('.nbd-workspace .main').show();
                        }else {
                            $('.nbd-workspace .main').hide();
                        }
                    }

                    $(this).parent().removeAttr('data-tab').attr('data-tab', nthTab);
                    $tab.removeClass('active');
                    $(this).addClass('active');
                    $tabContent.removeClass('before after left right');
                    $tabContent.each(function (j) {
                        j += 1;
                        if (i == j) {
                            $(this).addClass('active');
                            if (checkMobileDevice()) {
                                $(this).prevAll().addClass('left');
                                $(this).nextAll().addClass('right');
                            }else {
                                $(this).prevAll().addClass('before');
                                $(this).nextAll().addClass('after');
                            }

                        }else {
                            $(this).removeClass('active');
                        }
                    });
                });
            },
            tabPhto: {
                init: function () {
                    // this.main();
                    // this.masonry();

                    $('#tab-photo .nbd-items-dropdown').nbdDropdown({
                        'getServer': {},
                        'itemInRow': 3,
                        'itemDistance' : 20
                    });

                    var $termCheck = $('.type-upload .nbd-term .nbd-checkbox input');
                    var $formUpload = $('.nbd-sidebar .type-upload .form-upload');
                    var isUpload = false;
                    $termCheck.on('click', function () {
                        var $typeUpload = $(this).closest('.type-upload');
                        if ($(this).is(':checked')) {
                            $typeUpload.addClass('accept');
                            isUpload = true;
                        }else {
                            $typeUpload.removeClass('accept');
                            isUpload = false;
                        }
                    });
                    $formUpload.on('click', function () {
                        if (!isUpload) {
                            return false;
                        }
                    });

                },
                masonry: function (init) {
                    init = true;
                    imagesLoaded( $('#nbdesigner-gallery'), function() {
                        if( !init ) $('#nbdesigner-gallery').masonry('destroy');
                        $('#nbdesigner-gallery').masonry({
                            itemSelector: '.nbdesigner-item'
                        });
                        $.each($('#nbdesigner-gallery .nbdesigner-item'), function(e) {
                            $(this).addClass("in-view");
                        });
                    });
                },
                getImageItem: function () {
                    var src1 = 'https://media-public.canva.com/MABf-7qI6NA/1/thumbnail.jpg';
                    var src2 = 'https://media-public.canva.com/MABrm9_5-j0/3/thumbnail_large.jpg';
                    var src3 = 'https://media-public.canva.com/MABLiofkWpk/2/thumbnail_large.jpg';
                    var src4 = 'https://media-public.canva.com/MABKNOKek5k/1/thumbnail_large.jpg';
                    var src5 = 'https://media-public.canva.com/MABKNF1976I/1/thumbnail_large.jpg';
                    var src6 = 'https://media-public.canva.com/MABKNNgN1-U/1/thumbnail_large.jpg';
                    var src7 = 'https://media-public.canva.com/MABjD-hdPCA/1/thumbnail.jpg';
                    var src8 = 'https://media-public.canva.com/MABKNCXtIVk/1/thumbnail_large.jpg';
                    var src9 = 'https://media-public.canva.com/MABKNJM4T9E/1/thumbnail_large.jpg';
                    var src10 = 'https://media-public.canva.com/MABKNEG7Fmc/1/thumbnail_large.jpg';
                    var item = '' +
                        '<div class="nbdesigner-item"><img src="' + src1 + '"><span class="photo-desc">xxxxxx</span></div>' +
                        '<div class="nbdesigner-item"><img src="' + src2 + '"><span class="photo-desc">xxxxxx</span></div>' +
                        '<div class="nbdesigner-item"><img src="' + src3 + '"><span class="photo-desc">xxxxxx</span></div>' +
                        '<div class="nbdesigner-item"><img src="' + src4 + '"><span class="photo-desc">xxxxxx</span></div>' +
                        '<div class="nbdesigner-item"><img src="' + src5 + '"><span class="photo-desc">xxxxxx</span></div>' +
                        '<div class="nbdesigner-item"><img src="' + src6 + '"><span class="photo-desc">xxxxxx</span></div>' +
                        '<div class="nbdesigner-item"><img src="' + src7 + '"><span class="photo-desc">xxxxxx</span></div>' +
                        '<div class="nbdesigner-item"><img src="' + src8 + '"><span class="photo-desc">xxxxxx</span></div>' +
                        '<div class="nbdesigner-item"><img src="' + src9 + '"><span class="photo-desc">xxxxxx</span></div>' +
                        '<div class="nbdesigner-item"><img src="' + src10 + '"><span class="photo-desc">xxxxxx</span></div>';
                    return item;
                },
                initPositionCate: function () {
                    var $category = $('.nbd-sidebar #tab-photo .categories .category');
                    $category.each(function () {
                        var index = $(this).index();
                        var indexMod = index % 3;
                        var indexI = parseInt(index / 3);
                        $(this).css({
                            'left': 115 * indexMod + 'px',
                            'top' : 132 * indexI + 'px'
                        });
                    });
                }
            },
            tabLayer: {
                init: function () {
                    this.main();
                    this.actionLayer();
                },
                main: function () {
                    modern.sideBar.tabLayer.sortable();
                },
                sortable: function () {
                    var $tabLayer = $('.nbd-sidebar #tab-layer');
                    var $menuLayer = $('.nbd-sidebar #tab-layer .menu-layer');
                    $menuLayer.sortable();
                    // $menuLayer.disableSelection();
                },
                actionLayer: function () {
                    var $menuLayer = $('.nbd-sidebar #tab-layer .menu-layer');
                    var iconAction = $('.nbd-sidebar #tab-layer .menu-layer .item-right i');
                    iconAction.on('click', function () {
                        var dataAct = $(this).attr('data-act');
                        var dataActive = $(this).attr('data-active');
                        var $menuItem = $(this).closest('.menu-item');

                        switch (dataAct) {
                            case 'visibility':
                                if (dataActive == 'true') {
                                    $(this).removeClass('icon-nbd-fomat-visibility');
                                    $(this).addClass('icon-nbd-fomat-visibility-off');
                                }else{
                                    $(this).addClass('icon-nbd-fomat-visibility');
                                    $(this).removeClass('icon-nbd-fomat-visibility-off');
                                }
                                break;
                            case 'lock':

                                if (dataActive == 'true') {
                                    $(this).removeClass('icon-nbd-fomat-lock-open');
                                    $(this).addClass('icon-nbd-fomat-lock-outline');
                                    $menuItem.addClass('lock-active');
                                    // $menuItem.find('input').attr('disabled', 'disabled');
                                }else{
                                    $(this).removeClass('icon-nbd-fomat-lock-outline');
                                    $(this).addClass('icon-nbd-fomat-lock-open');
                                    $menuItem.removeClass('lock-active');
                                    // $menuItem.find('input').removeAttr('disabled');
                                }
                                break;
                            case 'close':
                                // TODO Code hear : delete layer
                                $(this).closest('.menu-item').remove();
                                break;
                            default:
                               return false;
                        }

                        if (dataActive == 'true') {
                            $(this).attr('data-active', 'false');
                        }else {
                            $(this).attr('data-active', 'true');
                        }

                    });
                },
            },
            tabProductTemplate: function () {
                var $tabProductTemplate = $('.nbd-sidebar #tab-product-template');
                var $product = $('.nbd-sidebar #tab-product .nbd-product');
                var $template = $('.nbd-sidebar #tab-template');
                var $closeTemplate = $('.nbd-sidebar #tab-template .close-template');
                var $productImg = $('.nbd-sidebar #tab-product .nbd-product .nbd-product-img');
                var $itemTemplate = $('.nbd-sidebar #tab-template .nbd-items-dropdown .main-items item');

                $productImg.on('click', function () {
                    $tabProductTemplate.addClass('template-show');
                    $template.addClass('animated slideInLeft');

                    $('#tab-template .nbd-items-dropdown').nbdDropdown({
                        'getServer': {},
                        'itemInRow': 2,
                        'itemDistance' : 10
                    });

                    // nbdTemplateDropdown.init();
                });
                $closeTemplate.on('click', function () {
                    $tabProductTemplate.removeClass('template-show');
                    $product.addClass('animated slideInRight');
                });
            },
            tabSvg : function () {
                // $('#tab-svg .nbd-items-dropdown').nbdDropdown({
                //     'getServer': {},
                //     'itemInRow': 3,
                //     'itemDistance' : 20
                // });

                $('#tab-svg .nbdesigner-gallery').masonry({
                    itemSelector: '.nbdesigner-item'
                });

            },
            tabTypography: function () {
                var $typographyItems = $('.nbd-sidebar .typography-items');
                var $typographyItem = $('.nbd-sidebar .typography-items .typography-item');
                var item = nbdGetItems.getImageItemTypography();
                for (var i=0;i<30;i++) {
                    $typographyItems.append(item);
                }
                $typographyItems.imagesLoaded()
                    .always( function( instance ) {
                        // All images loaded
                        setTimeout(function () {
                            $typographyItems.masonry({
                                itemSelector: '.typography-item'
                            });
                        }, 1000);
                    })
                    .done( function( instance ) {
                        // All images successfull loaded
                    })
                    .fail( function() {
                        // All images loaded, at least one is broken
                    })
                    .progress( function( instance, image ) {
                    });

            },
            tabElement : {
                init: function () {
                    $('#tab-element .nbd-items-dropdown').nbdDropdown({
                        'getServer': {},
                        'itemInRow': 3,
                        'itemDistance' : 20
                    });
                },
            }
        },
        toolBar: {
            init: function () {
                this.toolBarText();
                this.toolBarCommon();
                this.toolBarImage();
            },
            toolBarText: function () {
                var $menuRight = $('.nbd-toolbar .toolbar-text .menu-right');
                var $menuItemRight = $('.nbd-toolbar .toolbar-text .menu-right .menu-item:not(:first-child)');

                $menuItemRight.on('click', function () {
                    if ($(this).hasClass('selected')) {
                        $(this).removeClass('selected')
                    }else {
                        $(this).addClass('selected');
                    }
                });


            },
            toolBarCommon: function () {
//                var $colorPalette = $('.nbd-color-palette');
//                var $addColorPalette = $colorPalette.find('.color-palette-add');
//                var colorClick = false;
                // $addColorPalette.on('click', function () {
                //     if ($colorPalette.hasClass('show-popup')) {
                //         $colorPalette.removeClass('show-popup');
                //     }else {
                //         $colorPalette.addClass('show-popup');
                //     }
                // });

//                $colorPalette.on('click', function (e) {
//                    var $target = $(e.target);
//                    if (!$target.is('li')) {
//                        if ($(this).hasClass('show-popup')) {
//                            $(this).removeClass('show-popup');
//                        }
//                    }
//                });
//
//                $('.color-palette-popup').on('click', function () {
//                    return false;
//                });

            },
            toolBarImage: function () {
                var $scrollPreset = $('.nbd-toolbar .toolbar-image .filter-scroll');
                var $scrollRight = $('.nbd-toolbar .toolbar-image .filter-scroll.scrollRight');
                var $scrollLeft = $('.nbd-toolbar .toolbar-image .filter-scroll.scrollLeft');
                var $filterImg = $('.nbd-toolbar .toolbar-image .main-presets .preset');
                var $range = $('.nbd-toolbar .toolbar-image .main-ranges .range');
                var $inputSlide = $('.nbd-toolbar .toolbar-image .main-ranges .range .slide-input');

                $scrollPreset.on('click', function () {
                    var tranform = $filterImg.css('transform').split(/[()]/)[1];
                    var curPosTranform = parseInt(tranform.split(',')[4]);
                    var newPosTranform = 0;
                    var addTranform = $filterImg.outerWidth() * 3;
                    var minThreshold = 0;
                    var maxThreshold = -(parseInt($filterImg.length / 3) - 1) * addTranform;
                    if ($(this).hasClass('scrollLeft')) {
                        var newPosTranform = curPosTranform + addTranform;
                        if (curPosTranform >= minThreshold) {
                            $(this).filter('.scrollLeft').addClass('disable');
                            return false;
                        }else {
                            if ($scrollRight.hasClass('disable')) {
                                $scrollRight.removeClass('disable');
                            }
                            $filterImg.css({
                                'transform': 'translateX('+ newPosTranform +'px)'
                            });
                        }
                    }else if ($(this).hasClass('scrollRight')) {
                        var newPosTranform = curPosTranform - addTranform;
                        if (curPosTranform <= maxThreshold) {
                            $(this).filter('.scrollRight').addClass('disable');
                            return false;
                        }else {
                            if ($scrollLeft.hasClass('disable')) {
                                $scrollLeft.removeClass('disable');
                            }
                            $filterImg.css({
                                'transform': 'translateX('+ newPosTranform +'px)'
                            });
                        }
                    }else {
                        return false;
                    }
                });
//                $inputSlide.on({
//                    'change' : function () {
//                        var value = $(this).val();
//                        $(this).closest('.range').find('.value-display').text(value);
//                    },
//                    'mousedown' : function () {
//                        var value = $(this).val();
//                        $(this).closest('.range').find('.value-display').text(value);
//                    }
//                });
                $filterImg.on('click', function () {
                    $filterImg.removeClass('active');
                    $(this).addClass('active');
                });
            }
        },
        showPopup: function () {
            var $showPopupShare = $('.nbd-show-popup-share');
            var $showPopupFileType = $('.nbd-show-popup-fileType');
            var $showPopupTerm = $('.nbd-term .term-read');

            var $nbdPopup = $('.nbd-popup');
            var $nbdPopupShare = $('.nbd-popup.popup-share');
            var $nbdPopupFileType = $('.nbd-popup.popup-fileType');
            var $nbdPopupTerm = $('.nbd-popup.popup-term');
            var $nbdPopupSelect = $('.nbd-popup.popup-select');

            var $closePopup = $('.nbd-popup .overlay-popup,.nbd-popup .close-popup');
            var $mainPopup = $('.nbd-popup .main-popup');


            // Pop up share
            $showPopupShare.on('click', function () {
                $nbdPopupShare.addClass('show');
                // $nbdPopupShare.find('.main-popup').addClass('animated slideInUp');
            });

            // Popup file type
            $showPopupFileType.on('click', function () {
                $nbdPopupFileType.addClass('show');
            });
            $nbdPopupFileType.on('click', function () {
                return false;
            });

            // Popup term
            $showPopupTerm.on('click', function () {
                $nbdPopupTerm.addClass('show');
            });

            // Popup select
            $('.nbd-stages .icon-nbd-refresh').on('click', function () {
                $nbdPopupSelect.addClass('show');
            });

            // Close popup
            $closePopup.on('click', function () {
                $nbdPopup.removeClass('show');
            });
            $('.clear-stage-alert').on('click', function(e){
                if( e.target == this ){
                    $nbdPopup.removeClass('show');
                }
            });
        },
        actionPopupShare: function () {
            var $socialSare = $('.popup-share .socials .social');
            $socialSare.on('click', function () {
                $socialSare.removeClass('active');
                if (!$(this).hasClass('active')) {
                    $(this).addClass('active');
                }
            });
        },
        actionPopupKeyboard: function () {
            var $iconKeyboard = $('.nbd-sidebar .keyboard-shortcuts i');
            var $popupKeyboard = $('.nbd-popup.popup-keyboard');
            $iconKeyboard.on('click', function () {
                $popupKeyboard.addClass('show');
            });
        },
        actionShowPreview: function () {
            var $iconShowPreview = $('.nbd-sidebar #tab-product .nbd-product .product-more-info');
            var $sidebarPreview = $('.nbd-sidebar .nbd-sidebar-preview')
            $iconShowPreview.on('click', function () {
                if ($sidebarPreview.hasClass('show')) {
                    $sidebarPreview.removeClass('show');
                }else {
                    $sidebarPreview.addClass('show');
                }
            });
            $sidebarPreview.find('.close-preview').on('click', function () {
                $sidebarPreview.removeClass('show');
            });
        },
        animateStart: function () {
            var $toolBar = $('#design-container .nbd-toolbar');
            var $mainBar = $('#design-container .nbd-main-bar');
            var $sideBar = $('#design-container .nbd-sidebar');
            var $sideBarTab = $('#design-container .nbd-sidebar .tabs-nav');
            var $sideBarTabContent = $('#design-container .nbd-sidebar .tabs-content');

            $(window).on('load', function () {
                if (!checkMobileDevice()) {
                    $sideBarTabContent.addClass('animated slideInDown');
                }
                $mainBar.find('.menu-item').each(function (i) {
                    i += 3;
                    $(this).addClass('animated slideInDown animate' + i * 100);
                });
                $sideBarTab.find('.tab').each(function (i) {
                    i += 3;
                    $(this).addClass('animated slideInLeft animate' + i * 100);
                });
            });
        },
        responsive: function () {
            if (checkMobileDevice()) {
                var $mainTab = $('.nbd-sidebar .main-tabs');
                var $tabs = $('.nbd-sidebar .main-tabs .tab');
                var $menuMobile = $('.nbd-main-bar .menu-mobile');
                var $tabContent = $('.nbd-sidebar .tabs-content .tab');
                var $tabMainContent = $('.nbd-sidebar .tabs-content .tab .tab-main');
                var isRtl = checkRtl();

                // Sidebar Tab
                $menuMobile.on('click', function () {
                    var $mainMenus = $('.nbd-main-bar .nbd-main-menu');
                    if ($(this).hasClass('icon-nbd-menu')) {
                        $(this).removeClass('icon-nbd-menu').addClass('icon-nbd-clear');
                        $mainMenus.each(function (i) {
                            if ($(this).hasClass('menu-left')) {
                                $(this).show();
                            }else {
                                $(this).hide();
                            }
                        });
                    }else{
                        $(this).removeClass('icon-nbd-clear').addClass('icon-nbd-menu');
                        $mainMenus.each(function (i) {
                            if ($(this).hasClass('menu-left')) {
                                $(this).hide();
                            }else {
                                $(this).show();
                            }
                        });
                    }
                });

                // swipe
                $tabMainContent.on({
                    'swiperight': function () {
                        // right to left
                        var $tabCur = $(this).closest('.tab');
                        var nthTab = $tabCur.prev().index();
                        var curSl = (isRtl) ? $mainTab.scrollLeft() : $mainTab.scrollLeft();
                        var tabW = $('.nbd-sidebar .main-tabs .tab').eq(nthTab-1).width();
                        if ($tabCur.hasClass('tab-first')) {
                            return;
                        }
                        $tabs.each(function (i) {
                            if (i == nthTab) {
                                $(this).addClass('active');
                            }else {
                                $(this).removeClass('active');
                            }
                        });

                        // $mainTab.scrollLeft(curSl - tabW);
                        if (isRtl) {
                            $mainTab.animate({scrollLeft: curSl + tabW}, 300);
                        }else{
                            $mainTab.animate({scrollLeft: curSl - tabW}, 300);
                        }
                        $tabCur.removeClass('active');
                        $tabCur.prev().addClass('active');
                        $tabContent.removeClass('right left');
                        $tabCur.prev().prevAll().addClass('left');
                        $tabCur.prev().nextAll().addClass('right');
                    },
                    'swipeleft': function () {
                        // left to right
                        var $tabCur = $(this).closest('.tab');
                        var nthTab = $tabCur.next().index()
                        var curSl = $mainTab.scrollLeft();
                        var tabW = $('.nbd-sidebar .main-tabs .tab').eq(nthTab-1).width();
                        if ($tabCur.hasClass('tab-last')) {
                            return;
                        }
                        $tabs.each(function (i) {
                            if (i == nthTab) {
                                $(this).addClass('active');
                            }else {
                                $(this).removeClass('active');
                            }
                        });
                        // $mainTab.scrollLeft(curSl + tabW);
                        if (isRtl) {
                            $mainTab.animate({scrollLeft: curSl - tabW}, 300);
                        }else {
                            $mainTab.animate({scrollLeft: curSl + tabW}, 300);
                        }
                        $tabCur.removeClass('active');
                        $tabCur.next().addClass('active');
                        $tabContent.removeClass('right left');
                        $tabCur.next().prevAll().addClass('left');
                        $tabCur.next().nextAll().addClass('right');
                    }
                });
            }
        }
    };
    var nbdGetItems = {
        getImageItemTypography: function () {
            var src = 'http://dev.cmsmart.net:3000/wp/wp-content/plugins/web-to-print-online-designer/data/typography/img/29.png';
            var item = '<li class="typography-item"><img src="' + src + '"></li>';
            return item;
        },
    };
    $.fn.nbdToasts = function (text) {
        var $toast = $('.nbd-toasts');
        var $toastText = $('.nbd-toasts span');
        var $closeToast = $('.nbd-toasts .nbd-close-toast');
        $toast.addClass('nbd-show');
        $toastText.empty().append(text);
        $closeToast.on('click', function () {
            $toast.removeClass('nbd-show');
        });
        setTimeout(function () {
            $toast.removeClass('nbd-show');
        }, 3000);
        return this;
    };
    $.fn.nbdDropdown = function (options) {
        var sefl = this;
        var defaults = {
            'getServer': {},
            // Item in 1 row
            'itemInRow': 3,
            // Margin Item
            'itemDistance' : 10
        };

        var opts = $.extend({}, $.fn.nbdDropdown.default, options);
        this.initPositionItem = function (items, item, itemInRow, itemDistance) {
            
            var leftItem = items.width() / itemInRow;
            var topItem = item.height() + itemDistance;
            item.show();
            item.each(function () {
                var index = $(this).index();
                var indexMod = index % itemInRow;
                var indexI = parseInt(index / itemInRow);
                $(this).css({
                    'left': leftItem * indexMod + 'px',
                    'top' : topItem * indexI + 'px'
                });
            });

        };
        this.getApiElement = function (dataType) {
            var result = '';
            var src = '';
            switch (dataType) {
                case 'shapes':
                    src = 'https://media-public.canva.com/MABrm9_5-j0/3/thumbnail_large.jpg';
                    result = '<div class="nbdesigner-item"><img src="' + src + '"><span class="photo-desc">xxxxxx</span></div>';
                    break;
                case 'icons':
                    src = 'https://media-public.canva.com/MABhGmG8RA8/1/thumbnail.jpg';
                    result = '<div class="nbdesigner-item"><img src="' + src + '"><span class="photo-desc">xxxxxx</span></div>';
                    break;
                case 'lines':
                    src = 'https://media-public.canva.com/MABKNAgIqvQ/1/thumbnail_large.jpg';
                    result = '<div class="nbdesigner-item"><img src="' + src + '"><span class="photo-desc">xxxxxx</span></div>';
                    break;
                case 'animal':
                    src = 'https://media-public.canva.com/MABKNAgIqvQ/1/thumbnail_large.jpg';
                    result = '<div class="nbdesigner-item"><img src="' + src + '"><span class="photo-desc">xxxxxx</span></div>';
                    break;
                case 'misc':
                    src = 'https://media-public.canva.com/MABhGmG8RA8/1/thumbnail.jpg';
                    result = '<div class="nbdesigner-item"><img src="' + src + '"><span class="photo-desc">xxxxxx</span></div>';
                    break;
                case 'facebook':
                    src = 'https://media-public.canva.com/MABhGmG8RA8/1/thumbnail.jpg';
                    result = '<div class="nbdesigner-item"><img src="' + src + '"><span class="photo-desc">xxxxxx</span></div>';
                    break;
                case 'dropbox':
                    src = 'https://media-public.canva.com/MABhGmG8RA8/1/thumbnail.jpg';
                    result = '<div class="nbdesigner-item"><img src="' + src + '"><span class="photo-desc">xxxxxx</span></div>';
                    break;
                case 'pixabay':
                    src = 'https://media-public.canva.com/MABhGmG8RA8/1/thumbnail.jpg';
                    result = '<div class="nbdesigner-item"><img src="' + src + '"><span class="photo-desc">xxxxxx</span></div>';
                    break;
                case 'unsplash':
                    src = 'https://media-public.canva.com/MABhGmG8RA8/1/thumbnail.jpg';
                    result = '<div class="nbdesigner-item"><img src="' + src + '"><span class="photo-desc">xxxxxx</span></div>';
                    break;
                case 'business-card':
                    src = 'http://demo2.cmsmart.net/web2print/wp-content/uploads/nbdesigner/designs/610bd64612/preview/frame_1.png';
                    result = '<div class="nbdesigner-item"><img src="' + src + '"><span class="photo-desc">xxxxxx</span></div>';
                    break;
                default:
                    alert('bbbb');
                    break;

            }
            return result;
        };

        return this.each(function () {
            var $items = $(this).find('.items');
            var $item = $(this).find('.item');
            var $mainItems = $(this).find('.main-items');
            var $resultLoaded = $(this).find('.result-loaded');
            var $galleryItem = $(this).find('.nbdesigner-gallery');
            var $infoSupport = $(this).find('.info-support');
            var $tabScroll = $(this).closest('.tab-scroll');
            var $contentItem = $(this).find('.result-loaded .content-item');
            var noItem = $item.length;
            var noItemRow = parseInt(noItem / opts.itemInRow);
            var itemHeight = $item.outerHeight() + opts.itemDistance;
            var $loadingGif = $(this).find('.loading-photo');
            var isMasonry = false;

            // ========================= Main================================================
            // init items
            sefl.initPositionItem($items, $item, opts.itemInRow, opts.itemDistance);
            // set height for content cate
            $mainItems.css({
                'height': noItemRow * itemHeight + 'px'
            });
            $item.on('click', function () {
                var indexItem = $(this).index();
                var indexItemRow = parseInt(indexItem / opts.itemInRow) + 1;
                var widthItem = $(this).outerWidth();
                var itemName = $(this).find('.item-name').text();
                var dataType = $(this).attr('data-type');
                var dataApi = $(this).attr('data-api');

                if (dataType == 'webcam') {
                    var $popupWebcam = $('.nbd-popup.popup-webcam');
                    $popupWebcam.addClass('show');
                    return false;
                }

                $infoSupport.find('span').text(itemName);
                // Set height for categories
                $mainItems.css({
                    'height': indexItemRow * itemHeight + 'px'
                });
                $mainItems.find('.pointer').css({
                    'left': ((widthItem) * (indexItem % opts.itemInRow + 1) - widthItem / 2)  + 'px'
                });

                if (dataApi == 'false') {

                    $resultLoaded.show().addClass('overflow-visible');
                    $contentItem.filter(function (index) {
                        return $(this).attr('data-type') === dataType;
                    }).show();
                    $galleryItem.hide();
                    if (!$mainItems.hasClass('active-expanded')) {
                        $(this).siblings().css({
                            'opacity': '0.5'
                        });
                        $mainItems.addClass('active-expanded');
                        $resultLoaded.addClass('loaded');
                        var nextAllItem = $items.find('.item:nth-child(' + indexItemRow * opts.itemInRow + ')').nextAll();
                        $(nextAllItem).each(function () {
                            $(this).hide();
                        });
                    }else {
                        $(this).css({
                            'opacity': '1'
                        });
                        $(this).siblings().css({
                            'opacity': '1'
                        });
                        $mainItems.removeClass('active-expanded');
                        sefl.initPositionItem($items, $item, opts.itemInRow, opts.itemDistance);
                        $resultLoaded.hide();
                        $contentItem.hide();
                        $resultLoaded.removeClass('loaded');
                    }
                    return false;
                }else {
                    $resultLoaded.removeClass('overflow-visible');
                    if (!$mainItems.hasClass('active-expanded')) {

                        $(this).siblings().css({
                            'opacity': '0.5'
                        });
                        var nextAllItem = $items.find('.item:nth-child(' + indexItemRow * opts.itemInRow + ')').nextAll();
                        $(nextAllItem).each(function () {
                            $(this).hide();
                        });

                        var item = sefl.getApiElement(dataType);
                        for (var i=0;i<30;i++) {
                            $galleryItem.append(item);
                        }

                        $resultLoaded.show();
                        $galleryItem.show();

                        $galleryItem.imagesLoaded()
                            .always( function( instance ) {
                                // All images loaded
                                setTimeout(function () {

                                    $mainItems.addClass('active-expanded');
                                    $resultLoaded.addClass('loaded');
                                    $loadingGif.hide();

                                    if (isMasonry) {
                                        $galleryItem.masonry('destroy');
                                    }
                                    $galleryItem.masonry({
                                        itemSelector: '.nbdesigner-item'
                                    });
                                    isMasonry = true;
                                    $galleryItem.find('.nbdesigner-item').each(function (i) {
                                        var animate = Math.floor(Math.random() * 10);
                                        animate = (animate + 1) * 100;
                                        $(this).addClass('slideInDown animated in-view  animate' + animate);
                                    });
                                    var resultHeight = $resultLoaded.height();
                                    var resultOfsetTop = $resultLoaded.offset().top;

                                    $tabScroll.on('scroll', function () {
                                        var scrollTop = $(this).scrollTop();
                                        if ((scrollTop > resultOfsetTop + 100) && (scrollTop < (resultOfsetTop+ resultHeight + 100))) {
                                            $infoSupport.addClass('slideInDown animated show');
                                        }else {
                                            $infoSupport.removeClass('slideInDown animated show');
                                        }
                                    });
                                }, 1000);
                            })
                            .done( function( instance ) {
                                // All images successfull loaded
                            })
                            .fail( function() {
                                // All images loaded, at least one is broken
                            })
                            .progress( function( instance, image ) {
                                var parentE = image.img.parentElement;
                                $loadingGif.show();
                            });

                    }else {
                        $(this).css({
                            'opacity': '1'
                        });
                        $(this).siblings().css({
                            'opacity': '1'
                        });
                        $mainItems.removeClass('active-expanded');
                        sefl.initPositionItem($items, $item, opts.itemInRow, opts.itemDistance);
                        $resultLoaded.find('.nbdesigner-gallery').empty();
                        $resultLoaded.hide();
                        $resultLoaded.removeClass('loaded');
                        $galleryItem.hide();
                        $contentItem.hide();

                    }

                    // Event click in close result
                    $infoSupport.find('.close-result-loaded').on('click', function () {

                        $mainItems.removeClass('active-expanded');
                        sefl.initPositionItem($items, $item, opts.itemInRow, opts.itemDistance);
                        $resultLoaded.find('.nbdesigner-gallery').empty();
                        $resultLoaded.hide();
                        $item.show().css({'opacity' : '1'});
                        $resultLoaded.removeClass('loaded');
                        $tabScroll.scrollTop(0);
                    });

                    return false;
                }

            });
        });

    };
    $.fn.nbdWarning = function (options) {
        var sefl = this;
        var defaults = {
            'text' : ''
        };
        var opts = $.extend({}, $.fn.nbdWarning.default, options);
        return this.each(function () {
            var $blockWarning = $(this) || $('.nbd-warning');
            var $itemWarning = $blockWarning.find('.item');
            if ($itemWarning.length < 3) {
                var htmlItem = '<div class="item main-warning">' +
                    '<i class="icon-nbd icon-nbd-baseline-warning warning"></i>' +
                    '<span class="title-warning">'+ opts.text +'</span>' +
                    '<i class="icon-nbd icon-nbd-clear close-warning"></i>' +
                    '</div>';
                $blockWarning.append(htmlItem).find('.item').delay(1).queue(function () {
                    $(this).addClass('nbd-show');
                });
            }

            var $close = $('.nbd-warning').find('.close-warning');
            $close.on('click', function () {
                $(this).closest('.item').removeClass('nbd-show');
                var xxx = this;
                setTimeout(function () {
                    xxx.closest('.item').remove();
                }, 300);
            });
        });
    };
    $.fn.nbdColorPalette = function (options) {
        var defaults = {};
        var opts = $.extend({}, $.fn.nbdWarning.default, options);
        return this.each(function () {
            var sefl = this;
            var $colorPalette = $('.nbd-color-palette');
            $(this).on('click', function (e) {
                var posL = $(this).offset().left;
                var toolbarL = $('.nbd-toolbar').offset().left;
                $colorPalette.css({
                    'left' : (posL - toolbarL) + 'px'
                });
                if (!$colorPalette.hasClass('show')) {
                    $colorPalette.addClass('show');
                }else {
                    $colorPalette.removeClass('show');
                }
            });
        });
    };
    $(document).ready(function () {
        var $loadingPage = $('.nbd-load-page');
        $loadingPage.hide();
        modern.init();

        $('.nbd-navigations .logo').on('click', function () {
            $('.nbd-warning').nbdWarning({
                text : 'Warning Trouble'
            });
        });
        $('.nbd-toolbar .menu-crop').on('click', function () {
            $(this).nbdToasts('iaassdsad');
        });
        $('.nbd-tooltip-hover').tooltipster({
            side: "top",
            theme: 'tooltipster-borderless',
        });  
        $('#toolbar-font-size-dropdown,#toolbar-font-familly-dropdown, .nbd-sidebar .tab-scroll').perfectScrollbar();
        $('.nbd-show-color-palette').nbdColorPalette();
    });
    function checkRtl() {
        var isRtl = false;
        if ($('body').hasClass('nbd-modern-rtl')) {
            isRtl = true;
        }
        return isRtl;
    }
})(jQuery);